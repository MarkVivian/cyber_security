                SSH
            ===========
- SSH (Secure shell) is a client-server protocol that gives you an authenticated, encrypted channel to a remote machine.
- Under the hood:
    > A server (sshd) listens on the TCP port (default 22) for incoming connections.
    > A client (ssh) connects, negotiates protocol version and encryption algorithms, then authenticates using password or public key methods.
    > Authentication types: public-key, password, host-based, GSSAPI/Kerberos, etc.
    > Once authenticated you get a secure channel - used for remote shells, remote command execution, port forwarding (tunnels), file transfer(SCP/SFTP) etc.
    > SSH multiplexes multiple logical channels (sessions, port forwards, file transfers) over the same TCP connections.
TTY - this is an interactive shell.
Common comands:
    -p port: Specifies the port to connect to on the remote host. The default is 22.
    -i identity_file: Selects a file from which the identity (private key) for public key authentication is read.
    -t TTY : forces a TTY even for commands.
    -tt : always allocate a TTY even if stdin isn't a terminal.


             FUNDAMENTAL CONCEPTS AND FILES TO KNOW.
            -----------------------------------------
> ~/.ssh/id_rsa (or id_ed25519, id_ecdsa, etc)
    - Your private key for public-key authentication. Keep it secret!

> ~/.ssh/id_rsa.pub (or id_ed25519.pub, etc)
    - Your public key. Can be shared freely.
    - Generated using:
        EG.
            ssh-keygen -t ed25519 -C "Your@me" # for Ed25519 keys
                OR 
            ssh-keygen -t rsa -b 4096 -C "Your@me" # for RSA keys

    - To copy public key to remote:
        EG.
            ssh-copy-id -i ~/.ssh/id_ed25519.pub user@remote_host 
                
                > appends the public key to remote user's ~/.ssh/authorized_keys for passwordless login.
                > you can also manually append the contents of the .pub file to remote's authorized_keys.

> ~/.ssh/authorized_keys 
    - on the server: contains public keys allowed for login.

> /etc/ssh/sshd_config 
    - server configuration file.

> /etc/ssh/ssh_config or ~/.ssh/config 
    - client configuration file.

> known_hosts (clients)
    - remembers host public keys to prevent man in the middle attacks.

> ssh-agent / ssh-add 
    - tools to manage private keys and cache passphrases.
    - They hold unlocked keys so you don't type passphrases repeatedly.

NOTE : permission matters
    > ~/.ssh directory should be 700 (drwx------)
    > private keys (id_rsa, id_ed25519, etc) should be 600 (-rw-------)
    > authorized_keys should be 600 (-rw-------)


                        USAGE
                    -----------
1. Intractive shell.
    - When you want to login and get a prompt.
        EG.
            ssh bandit4@bandit.labs.overthewire.org -p 2220

                > What it does.
                    Make SSH detect your local terminal, allocates a remote TTY, then gives you bandit4@... to type commands.


2. Run one command and exit.
    - When you just need output from a single command.
        EG.
            ssh user@remote.example.com df -h /

                > Runs df -h / remotely, prints the result locally, then disconnects.


3. Force a Terminal (-t / -tt)
    - When you need interactive behavior (e.g. sudo, editors) inside a non-interactive call.
        EG.
            ssh -tt user@host -p 2222 sudo journalctl -f

                > Allocates a TTY even in scripts or pipelines so sudo (and other TTY-aware programs) work.

4. Specify a port.(-p)
    - When the server listens somewhere other than port 22.
        ssh -p 2222 user@remote.example.com

            > connects on port 2222 instead of the default 22.


5. Use a specific identity file (-i)
    - When you have multiple SSH keys or a non-standard key location.
        EG.
            ssh -i ~/.ssh/id_ed25519_work alice@server

                > Uses the private key at ~/.ssh/id_ed25519_work to authenticate as alice 


6. Password-Automation with sshpass
    - insecure since password may appear in process list or logs.
        EG.
            sshpass -p 'MySecretPwd' ssh -p 2222 user@host

                > Injects MySecretPwd at the password prompt so you don't have to type it.


7. Generating a keypair.
    - When you're setting up key-based authentication for the first time.
        EG.
            ssh-keygen -t ed25519 -C "you@example.com"

                > Creates `~/.ssh/id_ed25519 and .pub , using the Ed25519 algorithm.
                > The public key (~/.ssh/id_ed25519.pub) is sent to the server you'll log into.
                > The private key (~/.ssh/id_ed25519) is kept secret.


8. Copying your public key to the server.
    - When you want passwordless logins going forward.
        EG.
            ssh-copy-id -i ~/.ssh/id_ed25519.pub user@remote.example.com

                > Appends your public key to ~/.ssh/authorized_keys on the remote.


9. Secure File Transfer with scp.
    - When you need to copy files over SSH.
        EG
            scp -P 2222 report.pdf user@host:/home/user/

                > Copies report.pdf into /home/user/ on the remote via port 2222.


10. Interactive File Transfer with sftp.
    - When you want an FTP-like shell over SSH.
        EG.
            sftp -P 2222 user@host 
            # then at the sftp> prompt, use commands like: ls, get file, put file

                > Opens an SFTP session where you can get, put and ls files interactively.


11. Local port forwarding (-L)
    - When you need to access a remote service as if it were local.
        EG.
            ssh -L 8080:localhost:80 user@host.

                > lets you browse http://localhost:8080 on your machine to see the remote's port 80.


12. Remote port forwarding (-R)
    - When you want to expose a local service on the remote.
        EG.
            ssh -R 9000:localhost:3000 user@host

                > Anyone on host connecting to port 9000 reaches your local port 3000.


13. Dynamic ("SOCKS") Proxy (-D)
    - When you want to route browser or tool traffic through the SSH tunnel.
        EG.
            ssh -D 1080 user@host

                > Sets up a SOCKS proxy on localhost:1080 - point your browser there to tunnel all traffic via host.


14.  Agent Forwarding (-A)
    - When you hop through a bastion to another server and want to reuse your local key.
        EG.
            ssh -A user@bastion.example.com
            # from bastion:
            ssh user@internal.example.com

                > Your local SSH agent handles authentication for the second hop—no private key on the bastion.


15. SSH Config File (~/.ssh/config)
    - When you have multiple servers or complex options - avoid long command lines.
        EG.
            Host web
                HostName web.example.com
                User deploy
                Port 2222
                IdentityFile ~/.ssh/id_ed25519_work
                ForwardAgent yes

            Host bastion
                HostName bastion.example.com
                User admin
                ProxyJump web

                > then simply
                    ssh web
                    ssh bastion

                    > saves you from typing -p, -i, -J, and -A every time.


16. Connection Multiplexing
    - When you open many SSH sessions to the same host and want speedier starts.
    - Add to ~/.ssh/config:
        EG.
            Host *
                ControlMaster auto
                ControlPath ~/.ssh/cm-%r@%h:%p
                ControlPersist 600

                    > Reuses an existing TCP connection for up to 10 minutes, making new sessions nearly instant.


17. options  
    EG.
        ssh -o OptionName=Value user@host 

        * Skipping Host‑Key Verification (-o StrictHostKeyChecking=no)
            - When you’re scripting against brand‑new or disposable servers (use with caution).
                EG.
                    ssh -o StrictHostKeyChecking=no user@newhost

                        > Automatically accepts the remote’s host key so you’re not prompted.
                        > Beware: opens you to MITM attacks if used carelessly.